<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Punjabi Stream</title>

  <!-- Favicon -->
  <link rel="icon" href="https://i.postimg.cc/FRDPFKpY/favicon-96x96.png" type="image/png">

  <!-- Include HLS.js library for HLS fallback support -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <!-- YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background-color: black;
      font-family: sans-serif;
      overflow: hidden;
    }
    #container { position: relative; width: 100vw; height: 100vh; }
    #stream, #hls-video {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    }
    #stream { border: none; z-index: 0; }
    #hls-video { object-fit: cover; z-index: 1; display: none; }
    #overlay { position: absolute; top:0; left:0; width:100%; height:100%; z-index:2; cursor:pointer; }
    #channelName {
      position: absolute; bottom:-60px; left:0; width:100%;
      background: rgba(0,41,107,0.7); color:#ffd500;
      padding:12px 20px; font-size:22px; font-weight:bold;
      text-align:center; opacity:0; transition: all 0.6s ease; z-index:3;
    }
    #channelName.show { bottom:0; opacity:1; }
    .loading {
      position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);
      width:50px; height:50px; border:5px solid rgba(255,213,0,0.3);
      border-radius:50%; border-top-color:#ffd500;
      animation: spin 1s ease-in-out infinite; z-index:4; display:none;
    }
    @keyframes spin { to { transform:translate(-50%, -50%) rotate(360deg); } }
  </style>
</head>
<body>
  <div id="container">
    <iframe id="stream" allow="autoplay; fullscreen" allowfullscreen></iframe>
    <video id="hls-video" playsinline></video>
    <div id="overlay"></div>
    <div id="channelName"></div>
    <div class="loading" id="loading"></div>
  </div>

  <script>
    const CHANNELS = [
      { 
        name: "1. Patna Sahib LIVE", 
        url: "https://www.youtube.com/embed/live_stream?channel=UCrrrlDzu3AqIDPzzSXsViLQ&autoplay=1&modestbranding=1&controls=0&rel=0",  
        fallback: "https://www.youtube.com/embed/TxSC4pCmrYY?autoplay=1&modestbranding=1&controls=0&rel=0",
        type: "youtube" 
      },
      { name: "2. PTC News LIVE", url: "https://www.youtube.com/embed/live_stream?channel=UCQLEbraENUGWh6p1Rv664rQ&autoplay=1&modestbranding=1&controls=0&rel=0", type: "youtube" }, 
      { name: "3. Hazur Sahib LIVE", url: "https://www.youtube.com/embed/live_stream?channel=UCuerQ47I9Y2qxr4eIopxbYw&autoplay=1&modestbranding=1&controls=0&rel=0", type: "youtube" },
      { name: "4. Fatehgarh Sahib LIVE", url: "https://www.youtube.com/embed/live_stream?channel=UCudVHqnOekwcvpzNpY8_ERw&autoplay=1&modestbranding=1&controls=0&rel=0", type: "youtube" },
      { name: "5. Chardikla Time TV", url: "https://www.yupptv.com/yupptvnew/channels/chardikala-time-tv/live/embed", type: "iframe" },
      { name: "6. DD Punjabi", url: "https://d3eyhgoylams0m.cloudfront.net/v1/manifest/93ce20f0f52760bf38be911ff4c91ed02aa2fd92/ed7bd2c7-8d10-4051-b397-2f6b90f99acb/20c8ad14-a158-4a42-8889-e032d070856e/2.m3u8", type: "hls" }
    ];

    const IFRAME = document.getElementById('stream');
    const HLS_VIDEO = document.getElementById('hls-video');
    const channelNameBox = document.getElementById('channelName');
    const loadingIndicator = document.getElementById('loading');

    let currentChannel = 0;
    let fallbackTimeout = null;
    let usingFallback = false;

    function loadChannel(index) {
      currentChannel = index;
      IFRAME.style.display = 'none';
      HLS_VIDEO.style.display = 'none';
      loadingIndicator.style.display = 'block';
      const channel = CHANNELS[index];
      usingFallback = false;

      if (channel.type === "youtube" || channel.type === "iframe") {
        IFRAME.style.display = 'block';
        IFRAME.src = channel.url;
        if (index === 0 && channel.fallback) {
          // Force fallback after 15s if not loaded
          fallbackTimeout = setTimeout(() => {
            checkStreamStatus();
          }, 15000);
        }
      } else if (channel.type === "hls") {
        HLS_VIDEO.style.display = 'block';
        HLS_VIDEO.src = channel.url;
        HLS_VIDEO.play().catch(()=>{});
        loadingIndicator.style.display = 'none';
      }
      showChannelName(channel.name);
    }

    // ✅ Strict fallback: always switch if 15s passes with no load
    function checkStreamStatus() {
      if (usingFallback) return;
      if (currentChannel === 0) {
        console.log("Main stream not loaded in time → switching to fallback");
        useFallback();
      }
    }

    function useFallback() {
      if (currentChannel === 0 && CHANNELS[0].fallback && !usingFallback) {
        usingFallback = true;
        IFRAME.src = CHANNELS[0].fallback;
        showChannelName(CHANNELS[0].name + " (Fallback)");
        loadingIndicator.style.display = 'none';
      }
    }

    function showChannelName(name) {
      channelNameBox.textContent = name;
      channelNameBox.classList.add("show");
      setTimeout(() => channelNameBox.classList.remove("show"), 3000);
    }

    // Cancel fallback if main iframe loads
    IFRAME.addEventListener("load", function() {
      loadingIndicator.style.display = 'none';
      if (currentChannel === 0 && fallbackTimeout) {
        console.log("Main stream loaded, cancelling fallback");
        clearTimeout(fallbackTimeout);
        fallbackTimeout = null;
      }
    });

    IFRAME.addEventListener("error", function() {
      loadingIndicator.style.display = 'none';
      if (currentChannel === 0 && !usingFallback) {
        console.log("Iframe error → switching to fallback");
        useFallback();
      }
    });

    document.getElementById("overlay").addEventListener("click", () => {
      currentChannel = (currentChannel + 1) % CHANNELS.length;
      loadChannel(currentChannel);
    });

    // Start with channel 1
    loadChannel(currentChannel);
  </script>
</body>
</html>
