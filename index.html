<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Punjabi Stream</title>

  <!-- Favicon -->
  <link rel="icon" href="https://i.postimg.cc/FRDPFKpY/favicon-96x96.png" type="image/png">

  <!-- HLS.js for .m3u8 streams -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <!-- YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <style>
    html, body {
      margin:0; padding:0; height:100%; background:black; overflow:hidden;
      font-family:sans-serif;
    }
    #container { position:relative; width:100vw; height:100vh; }
    #stream, #hls-video {
      position:absolute; top:0; left:0; width:100%; height:100%;
    }
    #stream { border:none; z-index:0; }
    #hls-video { object-fit:cover; z-index:1; display:none; }
    #overlay { position:absolute; top:0; left:0; width:100%; height:100%; z-index:2; cursor:pointer; }
    #channelName {
      position:absolute; bottom:-60px; left:0; width:100%;
      background:rgba(0,41,107,0.7); color:#ffd500;
      padding:12px 20px; font-size:22px; font-weight:bold;
      text-align:center; opacity:0; transition:all .6s ease; z-index:3;
    }
    #channelName.show { bottom:0; opacity:1; }
    .loading {
      position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
      width:50px; height:50px; border:5px solid rgba(255,213,0,0.3);
      border-radius:50%; border-top-color:#ffd500;
      animation:spin 1s linear infinite; z-index:4; display:none;
    }
    @keyframes spin { to { transform:translate(-50%,-50%) rotate(360deg); } }
  </style>
</head>
<body>
  <div id="container">
    <div id="stream"></div> <!-- YouTube player container -->
    <video id="hls-video" playsinline></video>
    <div id="overlay"></div>
    <div id="channelName"></div>
    <div class="loading" id="loading"></div>
  </div>

  <script>
    const CHANNELS = [
      { 
        name: "1. Patna Sahib LIVE", 
        url: "https://www.youtube.com/embed/live_stream?channel=UCrrrlDzu3AqIDPzzSXsViLQ",  
        fallback: "https://www.youtube.com/embed/TxSC4pCmrYY?autoplay=1&modestbranding=1&controls=0&rel=0",
        type: "youtube" 
      },
      { name: "2. PTC News LIVE", url: "https://www.youtube.com/embed/live_stream?channel=UCQLEbraENUGWh6p1Rv664rQ&autoplay=1&modestbranding=1&controls=0&rel=0", type: "youtube" }, 
      { name: "3. Hazur Sahib LIVE", url: "https://www.youtube.com/embed/live_stream?channel=UCuerQ47I9Y2qxr4eIopxbYw&autoplay=1&modestbranding=1&controls=0&rel=0", type: "youtube" },
      { name: "4. Fatehgarh Sahib LIVE", url: "https://www.youtube.com/embed/live_stream?channel=UCudVHqnOekwcvpzNpY8_ERw&autoplay=1&modestbranding=1&controls=0&rel=0", type: "youtube" },
      { name: "5. Chardikla Time TV", url: "https://www.yupptv.com/yupptvnew/channels/chardikala-time-tv/live/embed", type: "iframe" },
      { name: "6. DD Punjabi", url: "https://d3eyhgoylams0m.cloudfront.net/v1/manifest/93ce20f0f52760bf38be911ff4c91ed02aa2fd92/ed7bd2c7-8d10-4051-b397-2f6b90f99acb/20c8ad14-a158-4a42-8889-e032d070856e/2.m3u8", type: "hls" }
    ];

    const HLS_VIDEO = document.getElementById('hls-video');
    const channelNameBox = document.getElementById('channelName');
    const loadingIndicator = document.getElementById('loading');
    let currentChannel = 0;
    let youtubePlayer = null;
    let fallbackTimeout = null;
    let usingFallback = false;

    function onYouTubeIframeAPIReady() {
      // Start with the first channel
      loadChannel(currentChannel);
    }

    function loadChannel(index) {
      currentChannel = index;
      loadingIndicator.style.display = "block";
      HLS_VIDEO.style.display = "none";
      usingFallback = false;

      const channel = CHANNELS[index];

      if (index === 0) {
        // Channel 1 → YouTube API player with error detection
        if (youtubePlayer) { youtubePlayer.destroy(); }
        youtubePlayer = new YT.Player('stream', {
          height: "100%", width: "100%",
          events: {
            onReady: (event) => {
              event.target.loadVideoByUrl(channel.url);
              event.target.playVideo();
              loadingIndicator.style.display = "none";
            },
            onError: () => {
              console.log("YouTube error → switching to fallback");
              useFallback();
            }
          },
          playerVars: { autoplay:1, controls:0, modestbranding:1, rel:0 }
        });

        // Safety: fallback if no playback after 15s
        fallbackTimeout = setTimeout(() => {
          if (!usingFallback) {
            console.log("Timeout → switching to fallback");
            useFallback();
          }
        }, 15000);

      } else if (channel.type === "youtube" || channel.type === "iframe") {
        document.getElementById("stream").innerHTML =
          `<iframe src="${channel.url}" allow="autoplay; fullscreen" style="width:100%;height:100%;border:none;"></iframe>`;
        loadingIndicator.style.display = "none";

      } else if (channel.type === "hls") {
        HLS_VIDEO.style.display = "block";
        if (HLS_VIDEO.canPlayType("application/vnd.apple.mpegurl")) {
          HLS_VIDEO.src = channel.url;
          HLS_VIDEO.play().catch(()=>{});
        } else if (Hls.isSupported()) {
          const hls = new Hls();
          hls.loadSource(channel.url);
          hls.attachMedia(HLS_VIDEO);
          hls.on(Hls.Events.MANIFEST_PARSED, () => HLS_VIDEO.play().catch(()=>{}));
        }
        loadingIndicator.style.display = "none";
      }

      showChannelName(channel.name);
    }

    function useFallback() {
      const channel = CHANNELS[0];
      if (!usingFallback && channel.fallback) {
        usingFallback = true;
        document.getElementById("stream").innerHTML =
          `<iframe src="${channel.fallback}" allow="autoplay; fullscreen" style="width:100%;height:100%;border:none;"></iframe>`;
        showChannelName(channel.name + " (Fallback)");
        loadingIndicator.style.display = "none";
      }
    }

    function showChannelName(name) {
      channelNameBox.textContent = name;
      channelNameBox.classList.add("show");
      setTimeout(() => channelNameBox.classList.remove("show"), 3000);
    }

    // Overlay → next channel
    document.getElementById("overlay").addEventListener("click", () => {
      currentChannel = (currentChannel + 1) % CHANNELS.length;
      loadChannel(currentChannel);
    });
  </script>
</body>
</html>
